<!DOCTYPE HTML>

<html>

<head>
    <title>Observers: read reports, write reports or create your own topic!</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <meta itemprop="name" content="Observers">
    <meta itemprop="description" content="Discover, create and contribute to new topics!">
    
    <link rel="stylesheet" href="css/normalize.css">
    <link href="bootstrap/css/bootstrap.min.css" rel="stylesheet"/>
    <link href="bootstrap/css/bootstrap-theme.min.css" rel="stylesheet"/>
    <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet"/>

    <link rel="stylesheet" href="css/main.css"/>
    <link  rel="stylesheet" href="css/dashboard.css"/>

    <script src="js/vendor/modernizr-2.6.2.min.js"></script>

  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-46059536-1', 'gcdc2013-observers.appspot.com');
    ga('send', 'pageview');

  </script>
</head>

<body > 

    <header> <span id="fb-root"></span>
        <nav class="navbar navbar-default navbar-static-top" id="horizontal-menu" role="navigation">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="/">Observers</a>
            </div>
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav navbar-right">
                    <li><!--<a data-target="#createTopicModal" data-toggle="modal" >-->
                        <a id="create-topic-link" style="cursor: pointer; cursor: hand;" tabindex="0">
                        Start new topic </a>
                    </li>
                    <!--<li>
                        <a id="edit-topic-link" style="cursor: pointer; cursor: hand;" data-bind="{text: 'Edit topic', visible: (id && isAdmin)}">
                        </a>
                    </li>-->
                    <li data-bind="if: isLoggedIn()" class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                            <span><img class="img-responsive img-circle pull-left"  alt="Google profile image" data-bind="attr: {src: user().googlePublicProfilePhotoUrl, width:30, height:30}"/>
                            <span data-bind="text: userName"></span></span>
                            <b class="caret"></b>
                        </a>

                        <ul class="dropdown-menu">
                            <!--<li><a href="#">Manage my topics</a></li>-->
                            <li><a href="javascript:void(0)" onclick="userLogout()">Logout</a></li>
                            <li class="divider"></li>
                            <li><a href="javascript:void(0)" onclick="userDisconnect()">Delete my account</a></li>
                        </ul>
                    </li>
                    <li data-bind="visible: !isLoggedIn()"> <a> <span  id="signinButton" tabindex="0">
                        <span class="icon"></span>
                        <span class="buttonText">Sign in</span>                 
                    </span></a> </li>  
                    <li> <a class="fa fa-info-circle" onclick='showMoreInfo()' tabindex="0"> <span class="sr-only"> Help </span></a> </li>         
                </ul>
            </div>
        </nav>
    </header>


<div class="container clearfix">

<div id="homeStatus"></div>

<!-- Modal -->
<div id="createtopic-label" style="display: none"> Create new topic </div>
<div class="modal fade" id="create-topic-modal" tabindex="-1" role="dialog" aria-labelledby="createtopic-label" aria-hidden="true">
</div><!-- /.modal -->

<div id="more-info-label" style="display: none"> More info </div>
<div class="modal fade" id="more-info-modal" tabindex="-1" role="dialog" aria-labelledby="more-info-label" aria-hidden="true">
</div>

<div class="jumbotron">
<h1>Observers</h1>
<p class="lead">Easy, accessible and smart platform that shows the world what people are feeling about an issue, where they are and what are their concerns.  Here, you can see reports about various topics, send your own report, or even create a topic you are passionate about!</p>
<a href="#" class="btn btn-primary btn-lg" onclick="showMoreInfo()">More Info</a>
</div>

    <div class="row">
        <div class="dashboard  col-wrap ">
        <div class="col-md-12">

            <div class="panel panel-primary">
                <div class="panel-heading">
                    <h2 class="panel-title">Current Topics</h2>
                  </div>
                <!-- <div class="table-responsive">
                <table class="table table-hover table-striped" >
                    <tbody data-bind="template: {name: 'topics-template', foreach: topics}"></tbody>
                </table>
                </div>-->
                <!--<div class="panel-body"> </div>-->
                <div id="topic-list" class="list-group" data-bind="template: {name: 'topics-list-template', foreach: topics} ">
                    </div>

               <!-- <div class="panel-footer"></div>-->
            </div>
            
        </div>
    </div>
    </div>
    </div>


<footer>
    &copy; 2013 F. Tasse
    <a class="pull-right" href="https://plus.google.com/100962573176836284931" rel="publisher">Google+</a>
</footer>

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="js/vendor/jquery-1.10.2.min.js"><\/script>')</script>
<script type="text/javascript" src="https://www.google.com/jsapi"></script>
<!-- //-beg- concat_js -->
<script type="text/javascript" src="bootstrap/js/bootstrap.min.js"></script>
<script type="text/javascript" src="js/vendor/knockout-3.0.0.js"></script>
<script type="text/javascript" src="js/plugins.js"></script>
<script type="text/javascript" src="js/vendor/jquery.validate.min.js"></script>
<script type="text/javascript" src="js/main.js"></script>
<!-- //-end- concat_js -->
    
<script type="text/html" id="topics-list-template">
    <a  class="list-group-item" data-bind="{if: (id!=undefined),click: $root.goToTopic, attr: {href: 'dashboard.html?topicId='+id}}">
        <h4 class="list-group-item-heading" data-bind="{text: title}"> </h4> <span class="badge" data-bind="text: numReports"></span>
        <p data-bind="{text: shortDescription}"></p>
        <span class="glyphicon glyphicon-calendar"></span> <span data-bind="text: (new Date(created)).formatMMMDDYYYY()"></span>
        <span style="text-align:center;" href="#" data-bind="visible: (ownerUserId == $root.userId())" ><b  class="glyphicon glyphicon-user  pull-right" ></b></span>
    </a>
</script>

<script type="text/javascript">

    function TopicListModel () {
        var self = this;

        self.topics = ko.observableArray([]);

        self.isLoggedIn = ko.computed(function() {
          return (user() !== null);
        }, this);

        self.userName = ko.computed(function() {
        if (user() === null) {
            return null;
        }
        else { 
            return user().googleDisplayName;
        }
        }, this);

        self.userId = ko.computed(function() {
            if ( user() === null) { 
                return null;
            }
            else { 
                return  user().id;
            }
        }, this);

        self.goToTopic = function(topic) {
            window.location.href = "/dashboard.html?topicId=" + topic.id;
        };  

        self.removeTopic = function(topic) {
            self.topics.remove(topic);
            //jQuery('.container').showLoading();
            $.ajax({
                  url: 'api/topics?topicId=' + topic.id,
                  type: 'DELETE',
                  contentType: 'application/json; charset=utf-8',
                  dataType: 'json',
                  async: true,
                  success: function(result) {
                    
                    $("#homeStatus").html("<div class='alert alert-success'>"+"The topic titled \"" + topic.title + "\" was successfully deleted." +"</div>");
                  },
                  error: function(XMLHttpRequest, textStatus, errorThrown) {
                    var msg = "An error occured: " + textStatus + ". Please try again later";
                    $("#homeStatus").html("<div class='alert alert-danger'>"+msg +"</div>");
                    console.log("some error occured: ", errorThrown);
                  },
                  complete: function() {
                    //jQuery('.container').hideLoading();
                  }
                });
        };
    }

    (function () {
        "use strict";
        if (user() == null)
        {
            getUser();
        }
        var viewModel = new TopicListModel ();
        ko.applyBindings(viewModel);

        $.getScript("/js/jquery.showLoading.js", function(){

            jQuery('.container').showLoading();
            $.ajax({
                  url: 'api/topics',
                  type: 'GET',
                  contentType: 'application/json; charset=utf-8',
                  dataType: 'json',
                  async: true,
                  success: function(result) {
                    /*result.sort(function(a,b){
                        if (a.ownerUserId == b.ownerUserId) {
                            return a.created < b.created;
                        } else
                        {
                            if (a.ownerUserId  == viewModel.userId()) return  false;
                            if (b.ownerUserId == viewModel.userId)  return true;
                            else return a.created < b.created;
                        }
                    });*/
                    viewModel.topics(result);
                  },
                  error: function(XMLHttpRequest, textStatus, errorThrown) {
                    var msg = "An error occured: " + textStatus + ". Please try again later";
                    $("#homeStatus").html("<div class='alert alert-danger'>"+msg +"</div>");
                    console.log("some error occured: ", errorThrown);
                  },
                  complete: function() {
                    jQuery('.container').hideLoading();
                  }
                });
         });

    }());

</script>

</body>
</html>
